
## 컨테이너 실행

-------------------

### 도커 엔진 시작/종료 하기

* 도커 엔진은 컴퓨터의 리소스를 거의 차지 하지 않으므로 항상 동작상태여도 문제가 없다.
* `sudo systemctl start docker` : 도커 엔진 시작
* `sudo systemctl stop docker` : 도커 엔진 종료
* `sudo systemctl restart docker` : 도커 엔진 재시작
* `sudo systemctl status docker` : 도커 엔진 상태 확인
* `sudo systemctl enable docker` : 도커 엔진 자동 시작 설정
* `sudo systemctl disable docker` : 도커 엔진 자동 시작 해제

### 컨테이너의 기본적 사용 방법

* 컨테이너를 다루는 모든 명령은 docker 로 시작한다.
* `docker 상위커맨드[무엇을] 하위커맨드[어떻게] 이미지명[대상]`가 명령어의 기본형태이다.
* 명령어의 기본형태 앞에 옵션과 인자라는 추가정보가 붙을수도 있다
* -d : detached mode 흔히 말하는 백그라운드 모드
* -p : 호스트와 컨테이너의 포트를 연결 (포워딩)
* -v : 호스트와 컨테이너의 디렉토리를 연결 (마운트)
* -e : 컨테이너 내에서 사용할 환경변수 설정
* --name : 컨테이너 이름 설정
* --rm : 프로세스 종료시 컨테이너 자동 제거
* 커맨드
  * 무엇을 어떻게 할것인지 지정하는 부분
  * `docker container run`은 container 를 생략한 `docker run`으로 사용할 수 있다.
* 옵션
  * 옵션은 - 또는 --으로 시작하는게 일반적이지만 -기호를 붙이지 않아도 된다.
  * -d 옵션같이 - 를 하나만 사용하는 옵션은 한번에 모아서 쓸수 있다.
* 대상
  * 커맨드와 달리 구체적인 이름 지정
  * `container start [옵션] [대상]`
* 인자
  * 대상에 전달할 값을 지정한다. 문자코드, 포트번호 등 전달
  * `container run -p 80:80 nginx` : nginx 이미지를 사용하여 컨테이너를 생성하고 호스트의 80번 포트와 컨테이너의 80번 포트를 연결한다.
  * `docker run [옵션] [대상][태그] [인자]`

#### [실습] 도커 버전

* `docker version` : 도커 엔진의 버전을 확인한다.
```
ijisu@ijisuui-MacBook-Pro ~ % docker version
Client:
 Cloud integration: v1.0.35
 Version:           24.0.2
 .....
```

#### 도커 명령어

* 컨테이너 조작 관련 커맨드(상위 커맨드)
* 컨테이너를 실행하거나 종료하고 컨테이너 목록을 확인하는 등 컨테이너를 조작하는 명령어
* 컨테이너 대상으로 어떤일을 할지 하위 커맨드를 통해 지정
* `docker container 하위_커맨드 옵션`

| 하위커맨드  |                                                            내용                                                             |     생략 가능여부     |        주요옵션        |
|:------:|:-------------------------------------------------------------------------------------------------------------------------:|:---------------:|:------------------:|
| start  |                                                          컨테이너 시작                                                          |        O        |         -i         |
|  stop  |                                                          컨테이너 정지                                                          |        O        |      거의 사용 x       |
| create |                                                     도커 이미지로부터 컨테이너 생성                                                     |        O        | --name, -p, -v, -e |
|  run   |   도커 이미지를 내려받고 컨테이너를 생성해 실행(다운로드 필요시만), docker image pull, docker container create, docker container start 명령어를 한번에 실행    |        O        | --name, -p, -v, -e |
|   rm   |                                                       정지 상태 컨테이너 삭제                                                       |        O        |       -f, -v       |
|  exec  |                                                  실행중인 컨테이너 속세어 프로그램을 실행                                                   |        O        |       -f, -v       |
|   ls   |컨테이너 목록 출력|       *1        |         -a         |
|   cp   |도커 컨테이너와 도커 호스간에 파일 복사|        O        |      거의 사용 x       |
| commit | 도커 컨테이너를 이미지로 변환|        O        |      거의 사용 x       |

* 이미지 조작 관련 커맨드(상위 커맨드 image)
* 이미지를 내려받거나 검색하는 등 이미지와 관련된 기능을 실행하는 커맨드
* 이미지를 대상으로 어떤일을 할지는 하위커맨드를 통해 지정
* `docker image 하위_커맨드 옵션`

| 하위커맨드  |                                                            내용                                                             | 생략 가능여부 |  주요옵션   |
|:------:|:-------------------------------------------------------------------------------------------------------------------------:|:-------:|:-------:|
|  pull  |                                                       도커 이미지 내려받기                                                        |    O    | 거의 사용 x |
|rm|이미지 삭제|   *2    | 거의 사용 x |
|  ls   |                                                       도커 이미지 목록 출력                                                       |    X    | 거의 사용 x |
|build|Dockerfile로부터 이미지 생성|    O    |   -t    |

* 볼륨 조작 관련 커맨드(상위 커맨드 volume)
* 볼륨 생성, 목록 확인, 삭제 등 볼륨(컨테이너에 마운트 가능한 스토리지)와 관련된 기능을 실행하는 커맨드
* 볼륨을 대상으로 어떤일을 할지 하위 커맨드를 통해 지정
* `docker volume 하위_커맨드 옵션`

| 하위커맨드  |         내용         | 생략 가능여부 |  주요옵션   |
|:------:|:------------------:|:-------:|:-------:|
|  create  |       볼륨 생성        |    X    | --name  |
|inspect|    볼륨 상세 정보 확인     |    X    | 거의 사용 X |
|  ls   |      볼륨 목록 확인      |    X    |   -a    |
|prune| 현재 마운트 되지 않은 볼륨 삭제 |    X    | 거의 사용 x |
|rm|      지정 볼륨 삭제      |    X    | 거의 사용 x |

* 네트워크 조작 관련 커맨드(상위 커맨드 network)
* 도커 네트워크 생성, 삭제, 컨테이너의 네트워크 접속 및 접속 해제등 네트워크 관련된 기능을 실행하는 커맨드
* 도커 네트워크란 도커 요소간의 통신에 사용하는 가상 네트워크

| 하위커맨드  |         내용         | 생략 가능여부 |  주요옵션   |
|:------:|:------------------:|:-------:|:-------:|
|connect|컨테이너를 네트워크에 연결|    X    | 거의 사용 X |
|disconnect|컨테이너를 네트워크에서 연결 해제|    X    | 거의 사용 X |
|  create  |       네트워크 생성        |    X    | 거의 사용 X |
|inspect|    네트워크 상세 정보 확인     |    X    | 거의 사용 X |
|  ls   |      네트워크 목록 확인      |    X    | 거의 사용 X |
|prune| 현재 사용되지 않은 네트워크 삭제 |    X    | 거의 사용 X |
|rm|      지정 네트워크 삭제      |    X    | 거의 사용 X |


* 그 밖의 커맨드
* 도커 스웜과 관련된 커맨드

| 상위커맨드|                        내용                     |
|:------:|:---------------------------------------------:|
|checkpoint|    현재 상태를 일시적으로 저장한 후 나중에 해당 시점의 상태로 되돌릴수 있다. |
|node|                 도커 스웜의 노드를 관리한다.              |
|plugin|                도커 스웜의 플러그인을 관리한다.             |
|secret|                 도커 스웜의 비밀값을 관리한다.             |
|service|                 도커 스웜의 서비스를 관리한다.             |
|stack| 도커 스웜 또는 쿠버네티스에서 여러개의 서비스를 합쳐 구성한 스택을 관리하는 기능 |
|swarm|                 도커 스웜을 관리한다.                |
|system|                 도커 엔진의 시스템을 관리한다.             |

* 단독 커맨드
* 상위 커맨드 없이 단독으로 쓰이는 특수한 커맨드
* 주로 도커 허브의 검색이나 로그인 에 사용된다.

|단독 커맨드|           내용           |  주요 옵션  |
|:------:|:----------------------:|:-------:|
|login|     도커 레지스트리에 로그인      | -u, -p  |
|logout|    도커 레지스트리에서 로그아웃     | 거의 사용 X |
|search|      도커 레지스트리를 검색      | 거의 사용 X |
|version| 도커 엔진 및 명령행 도구의 버전을 출력 | 거의 사용 X |

### 컨테이너의 생성과 삭제

#### 컨테이너를 생성하고 실행하는 커맨드: docker run

* `docker run`은 `docker image pull, docker container create, docker container start`가 합쳐진 기능이다.
* `docker run (옵션) 이미지 (인자)`

|옵션형식| 내용|
|:-----:|:--------|
|--name 컨테이너_이름| 컨테이너 이름을 지정함|
|-p 호스트_포트번호:컨테이너_포트번호|포트번호를 지정함|
|-v 호스트_디스크: 컨테이너_디렉토리|볼륨을 마운트함|
|--net=네트워크_이름|컨테이너를 네트워크에 연결함|
|-e 환경변수_이름=값|백그라운드로 실행함|
|-d|백그라운드로 실행함|
|-i|컨테이너에 터미널을 연결함|
|-t|특수키를 사용하도록 함|
|-help|사용방법 안내 메시지를 출력함|

#### 컨테이너를 정지하는 커맨드: docker stop

* `docker stop 컨테이너_이름`
* 컨테이너를 삭제하기 위해 정지해야한다.

#### 컨테이너를 삭제하는 커맨드: docker rm

* `docker rm 컨테이너_이름`

#### docker ps 커맨드

* docker ps 는 컨테이너의 목록을 출력하는 기능을 한다.
* `docker ps (옵션)`

|항목|                                         내용                                         |
|:--:|:----------------------------------------------------------------------------------:|
|container ID| 컨테이너 식별자. 무작위 문자열이 할당된다. 본래는 64글자이지만 앞에서부터 12글자만 출력한다. 이 12글자만으로도 식별자 역활을 수행할수 있다. |
|image|                          컨테이너를 생성할때 사용한 이미지 이름과 태그가 표시된다.                          |
|command|                            컨테이너 실행시에 실행하도록 설정된 프로그램의 이름                            |
|created| 컨테이너가 생성된 시간. 시간이 지날수록 컨테이너의 식별자가 변경되므로 식별자가 변경되지 않는 한 컨테이너의 식별자로 사용할수 있다. |
|status| 컨테이너의 상태. Up, Exited, Created 등이 표시된다. Up은 실행중, Exited는 종료, Created는 생성만 되고 실행되지 않은 상태를 나타낸다. |
|ports| 컨테이너의 포트와 호스트의 포트를 연결한 정보. 호스트의 포트가 표시되지 않으면 컨테이너의 포트가 호스트의 포트와 연결되지 않은 상태를 나타낸다. |
|names| 컨테이너의 이름. 컨테이너를 생성할때 --name 옵션으로 지정하지 않으면 무작위 문자열이 할당된다. |

### 컨테이너 통신

#### 아파치

* 웹서버 기능을 제공하는 소프트웨어
* 아파치가 동작중인 서버에 파일을 두면 이 파일을 웹사이트 형태로 볼수 있다.
* 컨테이너에 접근이 가능하게 하려면 컨테이너를 실행할때 설정이 필요하다.
* 컨테이너 설정은 생성후 기본적으로 변경할수 없고 docker run 커맨드에 옵션 행태로 설정한다.

#### 컨테이너와 통신 하려면

* 컨테이너 속에서 실행중인 아파치는 외부와 직접 연결되지 않았기 때문에 외부에 접근할수 없다.
* 컨테이너를 실행중인 물리적 컴퓨터가 외부의 접근을 대신 받아 전달해주도록 해야한다.
* `-p 8080:80`으로 설정할수 있다.
* `docker run --name apa000ex2 -d -p 8080:80 httpd`

### 컨테이너 생성에 익숙해지기

* 컨테이너에는 다양한 종류가 있다.

|  이미지이름   |  컨테이너의 내용  |                               컨테이너 실행에 주로 사용되는 옵션 및 인자                            |
|:--------:|:----------:|:---------------------------------------------------------------------------------:|
|  ubuntu  |    우분투     |                       -d 없이 -it 옵션 사용. 인자는 /bin/bask 등 셸명령어 지정                    |
|  centos  |   CentOS   |                       -d 없이 -it 옵션 사용. 인자는 /bin/bask 등 셸명령어 지정                    |
|  debian  |   Debian   |                       -d 없이 -it 옵션 사용. 인자는 /bin/bask 등 셸명령어 지정                    |
|  fedora  |   Fedora   |                       -d 없이 -it 옵션 사용. 인자는 /bin/bask 등 셸명령어 지정                    |
| busybox  |  BizyBox   |                       -d 없이 -it 옵션 사용. 인자는 /bin/bask 등 셸명령어 지정                    |
|  alpine  |   Alpine   |                       -d 없이 -it 옵션 사용. 인자는 /bin/bask 등 셸명령어 지정                    |
|  httpd   |    아파치     |                              -d 로 백그라운드 실행. -p 로 포트번호 지정                          |
|  nginx   |    엔진엑스    |                              -d 로 백그라운드 실행. -p 로 포트번호 지정                          |
|  mysql   |   MySQL    |                   -d 사용 실행시 -e MYSQL_ROOT_PASSWORD 와 같이 루트 패스워드 지정                |
| postgres | PostgreSQL |                    -d 사용 실행시 -e POSTGRES_PASSWORD 와 같이 루트 패스워드 지정                 |
| mariaDB  |  MariaDB   |                   -d 사용 실행시 -e MYSQL_ROOT_PASSWORD 와 같이 루트 패스워드 지정                |
| openjdk  |  OpenJDK   |                       -d 를 사용하지 않고 인자로 java 명령등을 지정해 도구 형태로 사용                    |
|  python  |   Python   |                      -d 를 사용하지 않고 인자로 python 명령등을 지정해 도구 형태로 사용                   |
|   php    |    PHP     |                            웹서버가 포함된것과 실행 명령만 포함된것으로 나뉘어 제공                        |
|   ruby   |    RUBY    |                            웹서버가 포함된것과 실행 명령만 포함된것으로 나뉘어 제공                        |
|   perl   |    Perl    |                       -d 를 사용하지 않고 인자로 pear 명령등을 지정해 도구 형태로 사용                    |
|gcc|C/C++ 컴파일러|                        -d 를 사용하지 않고 인자로 gcc 명령등을 지정해 도구 형태로 사용                    |
|  node    |    Node    |                        -d 를 사용하지 않고 인자로 app 명령등을 지정해 도구 형태로 사용                    |
|registry|도커 레지스트리|                          -d 를 사용해 백그라운도 실행, -p 옵션으로 포트번호 지정                       |
|wordpress|워드프레스|   -d 를 사용해 백그라운도 실행, -p 옵션으로 포트번호 지정,MySQL, MariaDB 가 필요하며 접속에 필요한 패스워드는 -e 옵션으로 지정 |
|nextcloud|넥스트클라우드|                          -d 를 사용해 백그라운도 실행, -p 옵션으로 포트번호 지정                       |
|redmine|레드마인|           -d 를 사용해 백그라운도 실행, -p 옵션으로 포트번호 지정,MySQL, PostgreSQL 이 필요하다.            |

* `docker run --name apa000ex2 -d -p 8080:80 httpd`
* `docker run --name nginx000ex6 -d -p 8084:80 nginx`
* `docker run --name mysql000ex7 -dit -e MYSQL_ROOT_PASSWORD=myrootpass mysql`

|항목|                내용                 |
|:--:|:---------------------------------:|
|--name mysql000ex7|     컨테이너 이름을 mysql000ex7로 지정      |
|-dit|        백그라운드로 실행하고 터미널을 연결        |
|-e MYSQL_ROOT_PASSWORD=myrootpass|      루트 패스워드를 myrootpass로 지정      |
|mysql| 이미지 이름을 mysql로 지정, 버전을 지정안하면 최신버전 |

### 이미지 삭제

* 컨테이너를 삭제해도 이미지는 그대로 남아 쌓인다.
* 해당 이미지로 실행한 컨테이너가 남아 있으면 이미지를 삭제할수 없으므로 docker ps -a 와같이 컨테이너 목록을 출력해 확인하고 컨테이너를 먼저 종료및 삭제후 이미지를 삭제한다.
* `docker image rm 이미지_이름`
* `docker image rm 이미지_이름 이미지_이름 이미지_이름`으로 삭제할수 있다.
* `docker image ls 커맨드로`이미지 목록을 확인할수 있다.
* -a 옵션은 사용할수 없는데 컨테이너와 달리 실행중 종료등의 상태가 없기 때문에

|항목|                 내용                  |
|:--:|:-----------------------------------:|
|REPOSITORY|            이미지의 저장소와 이름             |
|TAG|              이미지의 버전정도              |
|IMAGE ID| 이미지의 식별자, 원래 64글자 이지만 앞 12글자만 출력한다. |
|CREATED|           이미지가 생성된후 경과 시간           |
|SIZE|              이미지의 용량정보              |