
## 도커의 동작 원리

---------------------

### 도커의 구조

* 일반적인 서버는 운영체제 위에 프로그램이나 데이터가 직접 올라가지만 도커를 사용하는 경우 운영체제 위에 도커엔진이 동작하고 그 위에서 컨테이너가 동작한다.
* 컨테이너 안에는 리눅스 운영체제 비슷한 무언가가 들어있다.
* 도커 엔진 아래에도 리눅스 운영체제가 있다, 컨테이너 속에 또 리눅스 운영체제 비슷한 무언가가 있다.
* 운영체제는 커널과, 인터페이스, 시스템 콜, 드라이버 로 구성되어 있다.
* 유저 영역에서 커널로 명령을 전달하여 하드웨어를 다룬다.
* 도커는 컨테이너가 완전히 분리돼 있으므로 컨테이너 속 운영체제 부분이 프로그램의 명령을 전달받고 이를 바탕으로 커널에 전달한다.
* 커널의 밑바탕에 있는것을 빌려쓰는 형태 덕분에 도커는 가벼움을 얻을수 있다.

#### 도커는 리눅스용

* 리눅스 운영체제가 동작하는것을 전제로 만들어졌다.
* 윈도우나 macOS 는 리눅스 운영체제를 끌어와 도커로 실행한다.

#### 운영체제의 역활

* 소프트웨어나 프로그램의 명령을 하드웨어에 전달하는 역활

### 도커 허브와 이미지, 컨테이너

* 컨테이너를 생성하려면 먼저 이미지를 만들어야 한다.
* 이미지는 이미지 자체로는 쓸모가 없고 컨테이너를 만드는데 사용한다.
* 이미지로 동일한 컨테이너를 여러개 만들수 있다.
* 컨테이너로도 이미지를 만들수 있다.
* 이미지로 컨테이너를 만들어 컨테이너를 개조해 다시 새로운 이미지를 만들수 있다.
  * 이미지 레이어로 스냅샷 기능
* 이미지를 export 하여 다른 서버나 컴퓨터에 도커엔진을 설치하고 컨테이너를 만들수 있다.

### 도커 허브

* [도커허브](https://hub.docker.com/)에 이미지가 구현되어 있다.
* 도커 허브는 공개된 컨테이너 이미지가 모여있는곳이다.

#### 안전한 컨테이너이미지 고르는법

* 공식 이미지 사용
* 커스텀 이미지를 만들어 직접 사용

#### 다양한 형태로 조합이 가능한 컨테이너

* 도커는 기본적으로 한 컨테이너에 한 프로그램이 동작하도록 설계되었다.
* 컨테이너 끼리 서로 다른 운영체제 배포판을 사용해도 아무 문제가 없다.
* 다만 컨테이너 로그인이나, 특정 DBMS 를 사용할땐 운영체제를 고려해야 한다.

### 도커 컨테이너의 생애주기와 데이터 저장

* 도커 컨테이너는 쓰고 버리는 일회용품이다.
* 소프트웨어가 업데이트 되었으면 새로운 컨테이너를 사용하는것이 좋다.
* 컨테이너를 만들고, 실행하고, 종료하고, 삭제하는 일련의 과정을 생애주기라고 한다.

#### 데이터 저장

* 컨테이너를 폐기하면 컨테이너 안에 데이터는 사라진다.
* 이런 일을 방지하기 위해 도커가 설치된 물리적 호스트의 디스크를 마운트해 이 디스크에 데이터를 저장한다.
* 도커는 데이터를 영속 저장하기 위해 볼륨과 바인드 마운트를 제공한다.

### 도커의 장점과 단점

* 장점
  * 독립된 환경으로 여러개의 컨테이너, 똑같은 애플리케이션을 여러개 띄울수 있다.
  * 이미지를 만들어 도커 허브에 배포할수 있고 이미지 내려받기로 손쉽게 사용할수 있다. 이동성이 좋다.
  * 컨테이너에 커널을 포함 시킬 필요가 없어서 가볍다.
  * 한대의 물리서버에 여러대의 서버를 띄울수 있고 격리된 환경으로 각각 안전한 상태로 실행된다.
  * 컨테이너 수정 생성이 쉬우므로 서버 관리가 용이하다.
  * 간단한 명령어로 다뤼기 쉽다.
* 단점
  * 리눅스용 소프트웨어만 지원한다.
  * 호스트서버에 문제가 생기면 모든 컨테이너에 영향이 간다.
  * 컨테이너 하나를 장기간에 걸쳐 사용할땐 장점을 느끼기 어렵다.
  * 도커엔진 위에서 구동되기 때문에 컨테이너를 하나만 사용하면 도커엔진이 단순한 오버헤드가 된다.
* 도커의 주 용도
  * 팀원들과 동일한 개발환경 제공
  * 격리된 환경으로 테스트 
  * 동일한 서버를 여러개 만든다.

