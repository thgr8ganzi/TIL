## Go Puff
<hr/>

### 요구사항
<hr/>

|   구분   |                                            내용                                             |
|:------:|:-----------------------------------------------------------------------------------------:|
|  핵심기능  |        - 사용자는 위치 기반으로 1시간 이내 배송 가능한 상품의 가용성을 조회가능<br/> - 사용자는 여러 상품을 동시에 주문할 수 있다.        |
| 비기능 요구 |     - 빠른 가용성 조회 100ms 이내로 응답<br/> - 강한 일관성<br/>- 파일 손실시 복구<br/>- 하루 1,000만 건의 주문을 처리      |
|   그외   | - 결제/구매 처리<br/> - 드라이버 라우팅 및 배송<br/> - 검색 및 카탈로그 API <br/>    취소 및 반품 <br/> 개인정보 보호 및 보안  |

### 주요 엔티티
<hr/>

* Item: 사용자가 주문하는 대상
* DistributionCenter(DC): 배송센터, 상품이 실제로 보관되는 물리적 위치
* Inventory: 특정 DC에 존재하는 상품의 실제 재고
* Order: 사용자가 주문한 상품(및 배송/청구 정보)

### 구조
<hr/>

|              시스템               |                         역활                         |
|:------------------------------:|:--------------------------------------------------:|
|             클라이언트              |   사용자의 위치 정보(X, Y)와 함께 가용성 조회 요청     |
|      Availability Service      |             요청을 받아 근처 DC 목록 조회 및 재고 확인            |
|         Nearby Service         | 사용자 위치 기준으로 배송 가능한 DC 목록 제공 |
|        Inventory Table      |   각 DC별 상품 재고 정보를 저장하는 DB(복제된 SQL 테이블)  |

### 요구사항 충족
<hr/>

* 위치 기반으로 배송 가능한 상품의 가용성을 조회가능
  * 고객 위치별로 가까운 DC 에 재고의 합을 union 해서 보냄
  * 유클리드 거리, 하버사인 공식 사용하여 거리 계산 가능
* 사용자는 여러 상품을 동시에 주문할 수 있다
  * 두개의 데이터 저장소로 분산락 구현
  * Postgresql SERIALIZABLE 레벨의 트랜잭션 사용
* 교통 상황과 운전 시간을 포함하여 가용성 조회를 수행
  * 기존 시스템은 단순 거리 계산으로 인근 DC를 파악하지만, 실제로는 강, 국경, 교통 상황 등으로 인해 주행 시간이 예상과 다를 수 있음
  * DC 위치를 사용자 위치와 주기적으로 동기화 하고 고정반경을 설정하여 해당하는 DC 만 가져옴
  * 외부 이동 시간 예측 서비스(예: Google Maps API)등을 이용하여 최적화 거리 전달
* 조회를 빠르고 확장 가능하게
  * 캐시를 활용하여 재고 관리(예: TTL 1분)
  * Postgresql Read Replica, Partitioning 활용하여 과부하 억제