## 멱등성 프로듀서, 트랜잭션 프로듀서와 컨슈머

### 멱등성 프로듀서

* 여러번 연산을 수행하더라도 동일한 결과를 나타냄
* 멱등성 프로듀서는 동일한 데이터를 여러번 전송하더라도 카프카 클러스터에 단 한번만 저장됨
* 기본 프로듀서의 동작 방식은 적어도 한번 전달을 지원
* 적어도 한번 전달이란 프로듀서가 클러스터에 데이터를 전송하여 저장할때 적이도 한번 이상 데이터를 적재할수 있고 데이터가 유실되지 않음을 뜻함
* 두번이상 적재할 가능성이 있으므로 데이터 중복 발생가능
* At least once : 적어도 한번 이상 전달
* At most once : 최대 한번 전달
* Exactly once : 정확히 한번 전달
* 데이터의 중복 적재를막기위해 enable.idempotence 옵션을 true로 설정
* 기본 프로듀서와 달리 데이터를 브로커로 전달할때 프로듀서의 PID 와 시퀀스 넘버를 함께 전달한다.
* PID : 프로듀서의 고유 식별자
* SID : 레코드의 전달 번호
* 멱등성 프로듀서는 동일한 세션에서만 정확히 한번 전달을 보장
* 동일한 세션은 PID 의  생명주기를 뜻함
* 애플리케이션에 이슈가 방생하여 종료되고 재시작 하면 PID 가 변경된다.
* retries 기본값은 integer.MAX_VALUE 로 설정되어 있어서 여러번 적재시도하고 브로커에는 한번만 적재
* PID 와 SID 가 멱등성 프로듀서에 전달하고 일정하지 않으면 OutOfOrderException 발생

### 트랜잭션 프로듀서, 컨슈머

* 카프카 트랜잭션은 다수의 파티션에 데이터를 저장할때 모든 데이터에 대해 동일한 원자성을 만족시키기 위해 사용
* 원자성을 마족시킨다는 의미는 다수의 데이터를 동일 트랜잭션으로 묶음으로 전체데이터를 처리하거나 말거나 한다.
* 트랜잭션 컨슈머는 파티션에 저장된 트랜잭션 레코드를 보고 트랜잭션이 완료(커밋)되었음을 확인하고 데이터를 가져간다.
* transactional.id 옵션을 설정하여 트랜잭션 프로듀서로 동작하도록 설정
* 프로듀서 별로 고유한 ID 를 설정하고 init, begin, commit 메서드를 사용하여 트랜잭션을 관리
* isolation.level 옵션을 read_committed 로 설정하면 커밋이 완료된 레코드들만 읽을수 있다.