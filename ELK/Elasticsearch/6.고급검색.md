## 고급 검색

### 한글 형태소 분석기

* 한글은 다른언어와 달리 조사나 접미사, 명서, 동사등과 결합하여 형태소 분석이 쉽지 않음
* 다양한 종류의 형태소 분석기가 있고 nori 분석기가 공식 분석기임

### 은전한닢 형태소 분석기

* 자바, 스칼라 두가지 종류 인터페이스 제공
* 삼성전자 같은 복합 명사는 분리해서 역색인
* 은전 한닢은 사용자 사전으로 이러한 경우 해결
* 사용자 사전은 Term 과 가중치 형태로 구성돼어 가중치의 값이 작을수록 그에따른 우선순위는 높아진다.

### nori 형태소 분석기

* 루씬 프로젝트에서 공식적으로 제공되는 한글 형태소 분석기 6.4 버전에서 공식 릴리스
* 기존 형태소 분석기에 비해 30%이상 빠르고 아파치 라이선스 2.0 채택
* 다른 서드파티 플러그인과 마찬가지로 직접 설치
* 하나의 토크나이저랑 두개의 토큰 필터로 구성
  * nori_tokenizer
  * nori_part_of_speech
  * nori_readingform
* 노리 토크나이저는 내부적으로 세종 말뭉치와 mecab-ko-dic 사전으로 사용
* config/nori/nori_tokenizer.json 파일을 수정하여 사용자 사전 추가 가능
* config/userdict_ko.txt 파일을 수정하여 사용자 사전 추가 가능
* nori_part_of_speech 토큰 필터는 품사 세트와 일치하는 토큰을 찾아 제거하는 필터
* nori_readingform 토큰 필터는 문서에 존재하는 한자를 한그로 변경하는 역활을 하는 필터

### 트위터 형태소 분석기

* 초기에는 트위터에서 직접 개발하였으나 2017년 4.4 버전 이후 openkoreatext.org 로 이관
* 정규화, 토큰화, 스테밍, 어구추출 등 가능
* 현재는 6.1.1 버전까지만 사용 가능
* plugin/elasticsearch-analysis-openkoreantext/dic/userdict_ko.txt 파일을 수정하여 사용자 사전 추가 가능

### 검색결과 하이라이트 하기

* 데이터를 검색할때 highlight 옵션을 사용해 수행할 필드를 지정하면 검색 결과로 하이라이트된 데이터의 일부가 함께 리턴된다.
* 검색결과에 <em> 태그로 감싸져서 리턴되며 이를 이용해 검색어와 일치하는 부분을 강조할 수 있다.
* em 태그는 기본적으로 사용자가 지정한 검색어와 일치하는 부분을 강조하는데 사용되지만 다른 태그로 변경 가능

### 스크립트를 이용해 동적으로 필드 추가

* 스크립트를 이용해 사용자가 특정 로직을 삽입하는것이 가능
* config 폴더에 scripts 폴더를 생성하고 그 안에 스크립트 파일을 추가
* in-request 스크립트는 검색 요청시마다 실행되는 스크립트, elasticsearch.yml 파일에 script.disable_dynamic 설정을 false 로 변경해야 사용 가능
* 페인리스(painless) 스크립트 도입으로 전문적인 스크립트 작성 가능

### 검색 템플릿을 이용한 동적쿼리 제공

* 검색 템플릿을 이용해 동적 쿼리를 제공할 수 있다.
* 검색 템플릿의 필드명과 파라미터를 사용해서 쿼리를 전송하고 템플릿에 제공한 파라미터로 실제 검색이 이뤄짐
* 검색 템플릿을 사용하면 클리아이언트 코드가 단순해짐
* 검색 템플릿은 config 폴더에 templates 폴더를 생성하고 그 안에 템플릿 파일을 추가

### 별칭을 사용해 항상 최신 인덱스 유지

* 엘라스틱 서치 클러스터 인덱스 매핑을 벼경하거나 꺠지면 삭제하고 다시 생성해야함
* 이러한 문제를 방지하기 위해 Alias 기능 제공
* 인덱스 생성시 별칭을 사용해 추가, 삭제시 새로운 인덱스 요청이 자연스럽게 이동

### 스냅숏을 이용한 백업 복구

* 클러스터와 인덱스의 데이터가 커질수록 백업의 필요성도 커진다
* 이를 위해 _snapshot API를 이용해 스냅숏을 생성하고 복구할 수 있다.
