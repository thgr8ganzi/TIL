
## 오브젝트

### pod

#### container

* 파드 안에는 하나의 독립적인 서비스를 구성할수 있는 컨테이너들이 있다.
* 그 컨테이너들은 서비스가 연결될수 있도록 포트를 가지고있다.
* 한 컨테이너가 포트를 하나이상 가질수 있지만 한 파드 내에서 컨테이너 끼리는 중복될수 없다
* 파드가 생성될때 고유의 ip 를 할당받는다.
* 쿠버네티스 클러스터 안에서만 유효한 ip 이다.
* 외부에서 접근할수 없다
* 파드가 삭제되어서 재 성성시 ip 가 바뀐다.
```
apiVersion: v1
kind: Pod
metadata:
  name: pod-1
spec:
  containers:
  - name: container1
    image: kubetm/p8000
    ports:
    - containerPort: 8000
  - name: container2
    image: kubetm/p8080
    ports:
    - containerPort: 8080
```

#### label

* 파드 뿐만 아니라 모든 오브젝트에 달수있고 파드에서 가장 많이 사용
* 목적에 따라 오브젝트를 분류한다.
* 라벨은 키와 값으로 구성되어있다.
* 한 파드에 여러개의 라벨을 달수있다.
```
apiVersion: v1
kind: Pod
metadata:
  name: pod-2
  labels:
    type: web
    lo: dev
spec:
  containers:
  - name: container
    image: kubetm/init
```
```
apiVersion: v1
kind: Service
metadata:
  name: svc-1
spec:
  selector:
    type: web
  ports:
  - port: 8080
```

#### node schedule

* 파드는 여러 노드중 한곳에 올라가야 하는데 어떤 노드에 올라갈지 결정하는것을 스케줄링이라고 한다.
```
apiVersion: v1
kind: Pod
metadata:
  name: pod-3
spec:
  nodeSelector:
    kubernetes.io/hostname: k8s-node1
  containers:
  - name: container
    image: kubetm/init
```
```
apiVersion: v1
kind: Pod
metadata:
  name: pod-4
spec:
  containers:
  - name: container
    image: kubetm/init
    resources:
      requests:
        memory: 2Gi
      limits:
        memory: 3Gi
        -- 메모리는 limit 를 넘길경우 바로 파드를 종료 시킨다.
        -- cpu 는 limit 를 넘길경우 requset 수치 까지 낮춘다 종료 x
```

### service

* 서비스는 자신의 클러스터 IP 를 가지고 있다.
* 서비스를 파드와 연결시키면 서비스의 IP 를 통해서도 파드에 접근할수 있다.
* 파드는 쿠버네티스 안에서 장애로 죽을수 있어서 재생성시 IP 가 바뀐다.
* 서비스는 사용자가 직접 지우지 않는 한 재생성 되거나 삭제되지 않는다.
* 클러스터 IP 는 쿠버네티스 클러스터 안에서만 유효하다.
* 클러스터 IP 는 외부에서 접근할수 없다.
* 클러스터 IP 는 여러개의 파드를 묶어서 하나의 서비스로 만들수 있다.
```
apiVersion: v1
kind: Pod
metadata:
  name: pod-1
  labels:
     app: pod
spec:
  nodeSelector:
    kubernetes.io/hostname: k8s-node1
  containers:
  - name: container
    image: kubetm/app
    ports:
    - containerPort: 8080
```
```
apiVersion: v1
kind: Service
metadata:
  name: svc-1
spec:
  selector:
    app: pod
  ports:
  - port: 9000
    targetPort: 8080
```
* 노드 포트 타입으로 서비스를 생성하면 클러스터 IP 와 같은 기능이 포함된다.
* 노드타입은 쿠버네티스 안에 연결된 모든 노드에 똑같은 포트가 할당되어 외부로 부터 접근이 가능하다.
* 어떤 노드에서 온 요청인지 상관없이 트래픽을 나눠서 전달해준다.
```
apiVersion: v1
kind: Service
metadata:
  name: svc-2
spec:
  selector:
    app: pod
  ports:
  - port: 9000
    targetPort: 8080
    nodePort: 30000
  type: NodePort
  externalTrafficPolicy: Local
  -- 해당 노드에게만 트래픽을 전달한다.
```
* 로드밸런서 타입은 노드포트의 성격을 그대로 가지고있다.
* 로드밸런서가 생겨서 각각의 노드에 트래픽을 분산시켜준다.
* 로드밸런서에 접근할수 있는 ip 는 기본적으로 생성되지 않고 플러그인으로 생성하거나 클라우드 서비스를 사용해야한다.
```
apiVersion: v1
kind: Service
metadata:
  name: svc-3
spec:
  selector:
    app: pod
  ports:
  - port: 9000
    targetPort: 8080
  type: LoadBalancer
```

* 클러스터 IP 는 외부에서 접근할수가 없고 클러스터 내에서만 사용하는 IP
* 주된작업은 쿠버네티스 대시보드관리, 각 서비스 상태 디버깅이다.
* 노드포트는 물리적인 호스트의 IP 를 통해서 파드에 접근한다.
* 대부분 호스트 IP 는 보안적으로 내부에서 접근할수 있게 구성하기 때문에
* 노드포트는 클러스터 밖에 있지만 내부망 안에서 접근해야 될때 사용한다.
* 일시적인 외부 연동용으로도 사용이 된다.
* 내부 환경에서 시스템개발 하다가 외부에 간단한 데모를 보여줘야 될때 네트워크 중계기에 포트포워딩 해서 외부에서 내부 시스템에 연결을 할때
* 로드밸런서는 외부에 서비스를 노출시킬때
* 내부 IP 가 노출되지 않고 외부 IP 를 통해서 안정적으로 서비스를 노출시킬수 있다

### vloume

